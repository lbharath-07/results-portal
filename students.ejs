<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>JNTUACEK | Admin Results Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel='stylesheet' href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css'><link rel="stylesheet" href="./style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <style>
        @media (max-width: 420px) {
            .students{
                margin-left: 0px;
                padding-left: 0%;
                transform: translateX(0px);
                width: 90%;
            }
            .students-table{
                margin-left: 0px;
                transform: translateX(100px);
            }
        }
    </style>
</head>
<body onload="showUploaded()">
<!-- partial:index.partial.html -->
<div class="sidebar">
  <div class="logo-details">
    <div class="logo_name">ADMIN PORTAL</div>
    <i class='bx bx-menu' id="btn"></i>
  </div>
  <ul class="nav-list">
    <li>
      <a href="/">
        <i class='bx bx-grid-alt'></i>
        <span class="links_name">Dashboard</span>
      </a>
      <span class="tooltip">Dashboard</span>
    </li>
   
    <li>
      <a href="/students">
        <i class='bx bx-group'></i>
        <span class="links_name">Students</span>
      </a>
      <span class="tooltip">Students</span>
    </li>
    <li>
      <a href="/regulations">
        <i class='bx bx-receipt'></i>
        <span class="links_name">Regulations</span>
      </a>
      <span class="tooltip">Regulations</span>
    </li>
    <li>
      <a href="/AdminResults">
        <i class='bx bx-folder'></i>
        <span class="links_name">Results</span>
      </a>
      <span class="tooltip">Results</span>
    </li>
    <li>
      <a href="/backlogs">
        <i class='bx bx-log-out-circle' ></i>
        <span class="links_name">Backlogs</span>
      </a>
      <span class="tooltip">Backlogs</span>
    </li>
    <li class="profile">
      <div class="profile-details">
        <img src="https://static.vecteezy.com/system/resources/previews/021/548/095/original/default-profile-picture-avatar-user-avatar-icon-person-icon-head-icon-profile-picture-icons-default-anonymous-user-male-and-female-businessman-photo-placeholder-social-network-avatar-portrait-free-vector.jpg" alt="profileImg" class="profile-img">
        <div class="name_job">
          <div class="name">Admin </div>
          <div class="job">JNTUACEK Results Admin</div>
        </div>
      </div>
      <i class='bx bx-log-out' id="log_out"></i>
    </li>
  </ul>
</div>
<section class="home-section">
  <div class="text">Students</div>
  <div class="all-options">
    <div class="edit-options">
        <div class="add-student" onclick="openPopup()"><button><i class='bx bx-plus-medical'></i> Student</button></div>
    </div>
    <div class="hr"></div>
        <div class="filters">
            <label for="studentRows"> Show
            <select name="studentRows" id="studentRows" onchange="changeLink()" value="<%= limit %>" >
              <option value="10">default</option>
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
            Entries
        </label>
        <label for="student-search">Search: 
            <input type="search" name="studentSearch" id="studentSearch" onchange="changeLink()" value="<%= search %>" placeholder="Search Students..."></label>
    </div>
</div>
    <div class="students">
        <table class="students-table">
            <tr>
            <th >S.No</th>
            <th>Roll Number</th>
            <th>Student Name</th>
            <th>Branch</th>
            <th>Joining year</th>
            <th>Performance</th>
            <th>Tools</th>
            </tr>
            <% 
            function open(val){%>
              <script>
                openPopup4();
                </script>
            <%}
            for(var j = 0;j<students.length;j++) {%>
                <tr>
                    <td><%= j+1 %></td>
                    <td><%= students[j].roll_number %></td>
                    <td><%= students[j].student_name %></td>
                    <td><%= students[j].branch %></td>
                    <td><%= students[j].joining_year %></td>
                    <td><a href="/studentPerformance?roll_no=<%= students[j].roll_number.toUpperCase() %>"><Button class="edit1"><i class="bx bx-search" ></i> View</Button></a></td>
                    <td><Button class="edit" onclick="openPopup4('<%= students[j].roll_number %>', '<%= students[j].student_name %>', '<%= students[j].branch %>', '<%= students[j].joining_year %>')"><i class="bx bx-edit-alt"></i> Edit</Button><button  onclick="openPopup3( '<%= students[j].roll_number%>' )" class="delete"><i class="bx bx-trash"></i> Delete</button></td>
                </tr>
            <%}; %>
        </table>
        
        <div>
        </div>
  </div>
  <div class="paging">
    <% if (students.length === 0) { %>
      <p>No results found.</p>
  <% } %>

  <% if (prevPage) { %>
      <a href="/students?page=<%= prevPage %>&limit=<%= limit %>&search=<%= search %>">Previous</a>
  <% } %>

  Page <%= currentPage %> of <%= totalPages %>

  <% if (nextPage) { %>
      <a href="/students?page=<%= nextPage %>&limit=<%= limit %>&search=<%= search %>">Next</a>
  <% } %>
  </div>
  <div id="popup" class="popup" >
    <div class="popup-head"><h2>Add Student Options</h2></div>
    <div class="boxes">
      <div class="box1" onclick="openPopup1()"><div class="box-icon"><i class="bx bx-user"></i></div><div class="box-name">One Student</div></div>
      <div class="box1" onclick="openPopup2()"><div class="box-icon"><i class="bx bx-group"></i></div><div class="box-name">Bulk Upload</div></div>
    </div>
    <button onclick="closePopup()" class="close"><i class="bx bx-x"></i></button>
</div>

<div id="overlay" class="overlay"></div>
<div class="inner-single-popup" id="inner-single-popup" >
  <form class="flex-column" action="/addStudent" method="post">
    <div class="popup-head"><h2>Add Student</h2></div>
    <label for="newRollNumber">Student Roll Number</label>
    <input type="text"  id = "newRollNumber" name = "newRollNumber"  placeholder="Roll Number..." required>
    <label for="newStudentName">Student Name</label>
    <input type="text" id = "newStudentName" name = "newStudentName" placeholder="Student Name..." required>
    <label for="newBranch">Branch</label>
    <input type="text" id = "newBranch" name = "newBranch" placeholder="Branch..." required>
    <label for="newJoiningYear">Joining Year</label>
    <input type="text" id = "newJoiningYear" name = "newJoiningYear" placeholder="Joining Year..." required>
    <button type="submit" class="submit"><i class="bx bx-plus-medical"></i> Add Student</button>
    <button onclick="closePopup1()" class="close"><i class="bx bx-x"></i></button>
  </form>
  </div>
  <div class="inner-bulk-popup" id="inner-bulk-popup">
    <div class="flex-column">
      <div class="popup-head"><h2>Select an Excel Sheet</h2></div>
      <form action="/addStudents" method="post" enctype="multipart/form-data">
      <input type="file" id="studentExcelSheet" name="studentExcelSheet" accept=".xlsx" hidden required onchange="showUploaded()">
      <div class="boxes">
      <div class="box1" onclick="document.getElementById('studentExcelSheet').click()" id="uploadFile">
        <div class="box-icon"><i class="bx bx-upload"></i></div>
        <div class="box-name">Upload Excel File</div>
      </div>
    </div>
      <button type="submit" class="submit"><i class="bx bx-plus-medical"></i> Add Students</button>
    </form>
      <button onclick="closePopup2()" class="close"><i class="bx bx-x"></i></button>
    </div>
    </div>
    <div class="delete-popup" id="delete-popup">
      <h2 style="color: red;"><i class="bx bx-error"></i> Warning</h2><br><hr><br>
      <p class="add-info">-- Confirm your delete: Are you sure you want to delete this record ?</p>
      <button onclick="closePopup3()" class="close"><i class="bx bx-x"></i></button>
      <br><br>
      <button onclick="deleteRecord()" class="delete" style="transform: scale(1.5);width: 60%;margin-left: 105px;"><i class="bx bx-trash"></i> Delete</button>
    </div>
    <input type="text" id="inserted" value="<%= inserted %>" hidden><input type="text" id="err" value="<%= err %>" hidden><input type="text" id="deleted" value="<%= deleted %>" hidden><input type="text" id="updated" value="<%= updated%>" hidden>
    
    <div id="edit-popup" style="left:35%">
      <form class="flex-column" action="/updateStudent" method="post">
        <div class="popup-head"><h2>Update Student</h2></div>
        <label for="editRollNumber">Student Roll Number</label>
        <input type="text"  id = "editRollNumber" name = "editRollNumber"  placeholder="Roll Number..." required>
        <label for="editStudentName">Student Name</label>
        <input type="text" id = "editStudentName" name = "editStudentName" placeholder="Student Name..." required>
        <label for="editBranch">Branch</label>
        <input type="text" id = "editBranch" name = "editBranch" placeholder="Branch..." required>
        <label for="editJoiningYear">Joining Year</label>
        <input type="text" id = "editJoiningYear" name = "editJoiningYear" placeholder="Joining Year..." required>
        <input type="text" id="rollID" name="rollID" hidden>
        <button type="button" onclick="closePopup4()" class="close"><i class="bx bx-x"></i></button>
        <button type="submit" class="submit"><i class="bx bx-log-in-circle"></i> Update Student</button>
        
      </form>
      </div>
<script src="popup.js"></script>
</section>
  <script  src="./script1.js"></script>
<script>
inserted = document.getElementById('inserted').value;
var deleted = document.getElementById('deleted').value;
err = document.getElementById('err').value;
updated = document.getElementById('updated').value;
if (inserted == 'false') { 
      swal({
        title: "Error!",
        text: err,
        icon: "error",
        button: "OK"
    }).then((value) => {
      history.replaceState(null, null, '/students');
    });
   } 
   else if(inserted == 'true') { 
    swal({
        title: "Success!",
        text: "Student(s) inserted successfully",
        icon: "success",
        button: "OK"
    }).then((value) => {
      history.replaceState(null, null, '/students');
    });
   } 
   if (deleted == 'false') { 
      swal({
        title: "Error!",
        text: err,
        icon: "error",
        button: "OK"
    }).then((value) => {
      history.replaceState(null, null, '/students');
    });
   } 
   else if(deleted == 'true') { 
    swal({
        title: "Success!",
        text: "Record deleted successfully",
        icon: "success",
        button: "OK"
    }).then((value) => {
      history.replaceState(null, null, '/students');
    });
   }if(updated == 'true') { 
    swal({
        title: "Success!",
        text: "Updated successfully!",
        icon: "success",
        button: "OK"
    }).then((value) => {
      history.replaceState(null, null, '/students');
    });
   } 
   function showUploaded(){
    ifile = document.getElementById('studentExcelSheet').files[0];
    if(ifile){
      document.getElementById('uploadFile').innerHTML='<div class ="box-name" style="margin-top:4vh">File Uploaded<i class="bx bxs-checkbox-checked"></i></div><br><h6 class="box-name" style="text-align:center;font-size:10px;">click again to change file<h6>';
    }
   }
   function changeLink(){
    window.location = "/students?search="+document.getElementById('studentSearch').value+"&limit="+document.getElementById('studentRows').value;
   }
   let link;
function openPopup3(val) {
    var popup = document.getElementById('delete-popup');
    var overlay = document.getElementById('overlay');
    popup.style.display = 'block';
    overlay.style.display = 'block';
    link = 'deleteStudent?id='+val;
}

function closePopup3() {
    var popup = document.getElementById('delete-popup');
    var overlay = document.getElementById('overlay');
    popup.style.display = 'none';
    overlay.style.display = 'none';
}
function deleteRecord(){
    window.location=link;
}
function openPopup4(val1, val2, val3, val4) {
    var popup = document.getElementById('edit-popup');
    var overlay = document.getElementById('overlay');
    popup.style.display = 'block';
    overlay.style.display = 'block';
    document.getElementById('editStudentName').value = val2;
    document.getElementById('editRollNumber').value = val1;
    document.getElementById('editBranch').value = val3;
    document.getElementById('editJoiningYear').value = val4;
    document.getElementById('rollID').value = val1;
}


function closePopup4() {
    var popup = document.getElementById('edit-popup');
    var overlay = document.getElementById('overlay');
    popup.style.display = 'none';
    overlay.style.display = 'none';
}
</script>
</body>
</html>
